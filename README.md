# Hi üëã, I'm Sergey Makarov

![Profile views](https://komarev.com/ghpvc/?username=sergey030520&label=Profile%20views&color=0e75b6&style=flat)

- üî≠ I‚Äôm currently working on [STM32-Graphics-Sensor](https://github.com/Sergey030520/STM32-Graphics-Sensor.git)  
- üë®‚Äçüíª All of my projects are available at [https://github.com/Sergey030520](https://github.com/Sergey030520)

## Languages and Tools

![C](https://github.com/tandpfun/skill-icons/blob/main/icons/C.svg) 
![CMake](https://github.com/tandpfun/skill-icons/blob/main/icons/CMake-Dark.svg) 
![VSCode](https://github.com/tandpfun/skill-icons/blob/main/icons/VSCode-Dark.svg) 
![Git](https://github.com/tandpfun/skill-icons/blob/main/icons/Git.svg) 

# STM32 Graphics + Sensor

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–ø–∏—Å–∞–Ω–∏–µ](#description_project)  
2. [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#features)  
3. [–î—Ä–∞–π–≤–µ—Ä—ã](#drivers)  
4. [–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞](#build_project)  
5. [–í—ã–±–æ—Ä –¥–∏—Å–ø–ª–µ—è](#choose_display)  
6. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#project_structure)  
7. [–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã](#example_work_project)
   - [–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª](#main_loop)
   - [–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã: –¥–∞—Ç—á–∏–∫ + OLED SSD1306](#example_sensor_oled)
   - [–†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –Ω–∞–ø—Ä—è–º—É—é](#draw_primitives_direct)
   - [–†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `graphics`](#draw_primitives_graphics)
   - [–ü—Ä–∏–º–µ—Ä —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π draw_pixel](#draw_primitives_with_draw_pixel)
9. [–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø–ª–∞—Ç—É](#flash_to_board)

---

## –û–ø–∏—Å–∞–Ω–∏–µ <a name="description_project"></a>

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è STM32F103** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–ø–ª–µ—è–º–∏ –∏ –¥–∞—Ç—á–∏–∫–æ–º —É—Å–∫–æ—Ä–µ–Ω–∏—è.  
–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –∏ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –≤—ã–≤–æ–¥–æ–º –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞—Ç—á–∏–∫–∞ **SC7A20H**.  

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **OLED SSD1306**, –Ω–æ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å **TFT ST7789**, –æ–ø—Ä–µ–¥–µ–ª–∏–≤ –º–∞–∫—Ä–æ—Å `TFT_DISPLAY` –≤ `CMakeLists.txt`.  
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å **–¥–∞—Ç—á–∏–∫–æ–º SC7A20H** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ **I2C**.  
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å **–¥–∏—Å–ø–ª–µ—è–º–∏ SSD1306 –∏ ST7789** ‚Äî —á–µ—Ä–µ–∑ **SPI**.  

–í –ø—Ä–æ–µ–∫—Ç–µ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª–æ–π **`gfx`** (–≤ –ø–∞–ø–∫–µ `middleware`), –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Å –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ –¥–∏—Å–ø–ª–µ–µ–≤.  
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –∫–æ–¥ –æ–¥–∏–Ω —Ä–∞–∑, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ —Å —Ä–∞–∑–Ω—ã–º–∏ —ç–∫—Ä–∞–Ω–∞–º–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.  
–¢–∞–∫–∂–µ –≤ `gfx` –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `gfx_test_display()`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç –Ω–∞ –¥–∏—Å–ø–ª–µ–π —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –∏ —Ç–µ–∫—Å—Ç.  

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ <a name="features"></a>

### –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞.
- –ü—Ä–∏–º–∏—Ç–∏–≤—ã: –ª–∏–Ω–∏—è (–∞–ª–≥–æ—Ä–∏—Ç–º –ë—Ä–µ–∑–µ–Ω—Ö–µ–º–∞), –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫, —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫, –∫—Ä—É–≥.
- –†–∞–±–æ—Ç–∞ —Å –±—É—Ñ–µ—Ä–æ–º –¥–∏—Å–ø–ª–µ—è.

### –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- UART –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –°–≤–æ—è —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–æ–≤ —Å —É—Ä–æ–≤–Ω—è–º–∏ (`LOG_INFO`, `LOG_ERROR`, `LOG_DEBUG`, `LOG_WARNING`).

---

## –î—Ä–∞–π–≤–µ—Ä—ã <a name="drivers"></a>

- **–î–∏—Å–ø–ª–µ–∏**:  
  - ST7789 (TFT)  
  - SSD1306 (OLED)  

- **–°–µ–Ω—Å–æ—Ä—ã**:  
  - SC7A20H (–∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä)  

- **–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è STM32F103**:  
  - GPIO, RCC  
  - SPI, I2C  
  - IRQ, DMA  
  - UART (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)  
  - TIM (—Ç–∞–π–º–µ—Ä—ã) , PWM 
  - LED  

---

## –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ <a name="build_project"></a>

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–±–æ—Ä–∫—É —Å –ø–æ–º–æ—â—å—é **CMake**.  

–ü—Ä–∏–º–µ—Ä —Å–±–æ—Ä–∫–∏ –Ω–∞ Linux:  
```bash
mkdir build
cd build
cmake ..
make
```
## –í—ã–±–æ—Ä –¥–∏—Å–ø–ª–µ—è <a name="choose_display"></a>

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **OLED SSD1306**.  
–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **TFT ST7789** –µ—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞:

#### 1. **–ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø—Ä–∏ —Å–±–æ—Ä–∫–µ**:  
```
cmake -DTFT_DISPLAY=ON ..
```

#### 2. **–ü—Ä—è–º–æ –≤ `CMakeLists.txt`**:

–î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É:  
```cmake
set(TFT_DISPLAY ON)
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ <a name="project_structure"></a>

```text
‚îú‚îÄ‚îÄ src/                      # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ (–º–æ–¥—É–ª–∏, —Ñ—É–Ω–∫—Ü–∏–∏, –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
‚îú‚îÄ‚îÄ drivers/
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # –û—Å–Ω–æ–≤–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã STM32 (GPIO, RCC, TIM, UART –∏ —Ç.–¥.)
‚îÇ   ‚îú‚îÄ‚îÄ devices/              # –î—Ä–∞–π–≤–µ—Ä—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ display-ST7789/   # SPI-–¥—Ä–∞–π–≤–µ—Ä –∏ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è ST7789
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ oled-SSD1306/     # SPI-–¥—Ä–∞–π–≤–µ—Ä –∏ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è SSD1306
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ graphics/         # –û–±–µ—Ä—Ç–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∏, –ø—Ä–∏–º–∏—Ç–∏–≤—ã
‚îÇ   ‚îî‚îÄ‚îÄ sensors/              # –î—Ä–∞–π–≤–µ—Ä—ã —Å–µ–Ω—Å–æ—Ä–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä SC7A20H (I2C)
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ gfx.c                 # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ + gfx_test_display()
‚îÇ   ‚îî‚îÄ‚îÄ logger/               # –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è UART + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ logger.c          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ logger.h          # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ include/                  # –ó–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ stm32f103.md          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ STM32F103
‚îú‚îÄ‚îÄ startup/
‚îÇ   ‚îî‚îÄ‚îÄ startup_stm32f103c8tx.s   # –°—Ç–∞—Ä—Ç–æ–≤—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ conf_mem_stm32f108/
‚îÇ   ‚îî‚îÄ‚îÄ STM32F103C8TX_FLASH.ld     # –õ–∏–Ω–∫–µ—Ä—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ CMakeLists.txt            # –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–í **middleware** –∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ñ–∞–π–ª—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–∏—Ñ–µ—Ä–∏–µ–π –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏:

- **tft_board.c/.h**  
  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SPI –¥–ª—è TFT-–¥–∏—Å–ø–ª–µ—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±–µ—Ä—Ç–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º –¥–∏—Å–ø–ª–µ—è.

- **oled_board.c/.h**  
  –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SPI –¥–ª—è OLED-–¥–∏—Å–ø–ª–µ—è –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±–µ—Ä—Ç–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º –¥–∏—Å–ø–ª–µ—è.

- **usart_board.c/.h**  
  –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UART –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

- **sensors.c/.h**  
  –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è I2C, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ–Ω—Å–æ—Ä–æ–≤.  
  –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∞—Ç—á–∏–∫–æ–≤.

- **gfx.c**  
  –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –≤—ã–∑–æ–≤—ã –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∏—Å–ø–ª–µ—è–º–∏.  
  –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `gfx_test_display()` –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –∏ —Ç–µ–∫—Å—Ç–∞.

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã <a name="example_work_project"></a>

### –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª <a name="main_loop"></a>
- –û–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞—Ç—á–∏–∫ **SC7A20H**.  
- –í—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–ø–ª–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî SSD1306).  

–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ –≤ `main.c`:
```c
int main()
{

    int status = init_board();
    if (status != 0)
    {
        ledOn(1);
        goto error;
    }

    LOG_INFO("–î—Ä–∞–π–≤–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã\r\n");

    print_clock_frequencies();

    sensors_init();

    gfx_drv_init();

    Vector vector = {0};

    while (1)
    {
        status = get_data_sensor_sc7a20h(&vector);
        if (status != 0)
        {
            LOG_INFO("Error get data sensor: %d\r\n", status);
        }
        else
        {
            display_sensor_data(&vector);
            LOG_INFO("Sensor SC7A20H: {x:%d,y:%d,z:%d}\r\n", vector.X, vector.Y, vector.Z); 
        }
        delay_timer(5000);
    }

error:
    while (1)
        ;

    return 0;
}
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã: –¥–∞—Ç—á–∏–∫ + OLED SSD1306 <a name="example_sensor_oled"></a>

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–∞ **SC7A20H** –≤—ã–≤–æ–¥—è—Ç—Å—è –Ω–∞ –¥–∏—Å–ø–ª–µ–π **SSD1306** –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ UART (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 9600 –±–æ–¥).  

#### –§–æ—Ç–æ –¥–∏—Å–ø–ª–µ—è

![OLED SSD1306 Display](docs/images/sensor_oled_display.jpg)  
*–ù–∞ —Ñ–æ—Ç–æ –ø–æ–∫–∞–∑–∞–Ω—ã —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ SC7A20H –Ω–∞ –¥–∏—Å–ø–ª–µ–µ.*

#### –§–æ—Ç–æ –ø–ª–∞—Ç—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –¥–∞—Ç—á–∏–∫–∞

![STM32F103 Wiring](docs/images/stm32f103_wiring.jpg)  
*–í–∏–¥ —Å–≤–µ—Ä—Ö—É –Ω–∞ STM32F103 —Å –ø—Ä–æ–≤–æ–¥–∞–º–∏, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –∫ –¥–∞—Ç—á–∏–∫—É SC7A20H –∏ OLED SSD1306.*

![Overall Setup](docs/images/overall_setup.jpg)  
*–í–∏–¥ —Å–≤–µ—Ä—Ö—É –≤—Å–µ–π —Å–±–æ—Ä–∫–∏ —Å –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–º –¥–∞—Ç—á–∏–∫–æ–º –∏ –¥–∏—Å–ø–ª–µ–µ–º.*

#### –õ–æ–≥–∏ UART

```
[main.c:35] –î—Ä–∞–π–≤–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
[main.c:151] SYSCLK: 72000000 Hz
[main.c:152] HCLK  : 72000000 Hz
[main.c:153] APB1  : 36000000 Hz
[main.c:154] APB2  : 72000000 Hz
[main.c:155] USB  : 48000000 Hz
[main.c:156] ADC  : 12000000 Hz
[main.c:157] source: 2
[main.c:55] Sensor SC7A20H: {x:8235,y:16598,z:-4066}
[main.c:55] Sensor SC7A20H: {x:28714,y:-16171,z:-12258}
[main.c:55] Sensor SC7A20H: {x:-8150,y:-16171,z:-20449}
[main.c:55] Sensor SC7A20H: {x:24619,y:-24363,z:-4066}
[main.c:55] Sensor SC7A20H: {x:28715,y:16597,z:-20449}
```

### –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –Ω–∞–ø—Ä—è–º—É—é <a name="draw_primitives_direct"></a>

```c
gfx_drv_fill((Point){0, 0}, (Point){disp.width - 1, disp.height - 1});
gfx_drv_draw_line((Point){0, 0}, (Point){disp.width - 1, disp.height - 1});
gfx_drv_draw_line((Point){0, disp.height - 1}, (Point){disp.width - 1, 0});
gfx_drv_draw_rect((Point){10, 10}, (Point){50, 30});
gfx_drv_draw_triangle((Point){60, 20}, (Point){90, 50}, (Point){40, 50});
gfx_drv_draw_circle((Point){disp.width/2, disp.height/2}, 20);
gfx_drv_draw_string(0, 0, "Test");
gfx_drv_fill((Point){5, 5}, (Point){15, 15});
```
### –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `graphics` <a name="draw_primitives_graphics"></a>

–î–ª—è —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Å–ø–ª–µ—è:

```c
typedef struct {
    void (*draw_pixel)(uint16_t x, uint16_t y, GFX_Color color);
    uint16_t width;
    uint16_t height;
} GFX_Display_t;
```
### –ü—Ä–∏–º–µ—Ä —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ (—á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `graphics` —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π draw_pixel) <a name="draw_primitives_with_draw_pixel"></a>

> –ü—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Ä–∏—Å–æ–≤–∞—Ç—å –ª–∏–Ω–∏–∏, –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, –∫—Ä—É–≥–∏, —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏ –∏ —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `graphics`, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É `GFX_Display_t`, –≥–¥–µ –≤—ã —Å–∞–º–∏ –∑–∞–¥–∞—ë—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–∏–∫—Å–µ–ª—è (`draw_pixel`), —Ä–∞–∑–º–µ—Ä—ã –¥–∏—Å–ø–ª–µ—è –∏ —Ç–µ–∫—É—â–∏–µ —Ü–≤–µ—Ç–∞.

```
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏—Å–ø–ª–µ—è
GFX_Display_t disp;
disp.width = SSD1306_WIDTH;
disp.height = SSD1306_HEIGHT;
disp.draw_pixel = gfx_draw_pixel_gfx;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–∏—Ö —Ü–≤–µ—Ç–æ–≤
static GFX_Color current_color = {.value = 1};
static GFX_Color current_bg_color = {.value = 0};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —à—Ä–∏—Ñ—Ç–∞
GFX_Font_t *current_font = &font5x7_struct;
gfx_set_font(current_font);

// –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤
gfx_draw_line(&disp, (Point){0,0}, (Point){50,50}, current_color);
gfx_draw_rect(&disp, (Point){10,10}, (Point){40,20}, current_color);
gfx_draw_circle(&disp, (Point){64,32}, 15, current_color);
gfx_draw_triangle(&disp, (Point){20,20}, (Point){40,20}, (Point){30,40}, current_color);

// –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
gfx_draw_char(&disp, 5, 5, 'A', current_color, current_bg_color);
gfx_draw_string(&disp, 10, 10, "Hello GFX", current_color, current_bg_color);

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏
gfx_fill(&disp, (Point){0,0}, (Point){disp.width-1, disp.height-1}, current_bg_color);

```

## –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø–ª–∞—Ç—É <a name="flash_to_board"></a>

–ù–∞ Linux –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É `st-flash`:

```
sudo apt install stlink-tools
```

–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—à–∏–≤–∫–∏ –Ω–∞ STM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç load_stm_data.sh —Å —É—Ç–∏–ª–∏—Ç–æ–π st-flash:
```
./load_stm_data.sh
```
